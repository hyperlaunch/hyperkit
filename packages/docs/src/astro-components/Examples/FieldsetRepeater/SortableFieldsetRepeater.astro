---
type Props = {
  id: string;
};
const { id } = Astro.props;

const items = [
  { id: "item-1", fname: "Chris", lname: "Garrett" },
  { id: "item-2", fname: "Sumuva", lname: "Guy" },
];
---

<div class="w-72 lg:w-96 bg-white rounded-lg shadow-md p-6">
  <div class="text-lg font-semibold text-zinc-900">Fieldset Repeater</div>
  <hyperkit-fieldset-repeater id={id}>
    <hyperkit-sortable class="flex flex-col">
      {
        items.map((item) => (
          <hyperkit-sortable-item class="py-2 border-b border-b-zinc-200 data-[before]:border-t-2 data-[before]:border-t-blue-400 data-[after]:border-b-2 data-[after]:border-b-blue-400">
            <hyperkit-repeated-fieldset class="flex items-end justify-between">
              <hyperkit-sortable-handle>
                <button class="pb-1 cursor-move text-zinc-400 select-none font-black">
                  &#8942;
                </button>
              </hyperkit-sortable-handle>
              <label class="mr-2">
                <div class="mb-1 text-zinc-600 text-xs">First Name:</div>
                <input
                  type="text"
                  name={`items-${id}[][firstname]`}
                  value={item.fname}
                  class="w-16 lg:w-24 px-3 py-2 text-xs text-gray-800 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                />
              </label>
              <label>
                <div class="mb-1 text-zinc-600 text-xs">Last Name:</div>
                <input
                  type="text"
                  name={`items-${id}[][lastname]`}
                  value={item.lname}
                  class="w-16 lg:w-24 px-3 py-2 text-xs text-gray-800 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                />
              </label>
              <hyperkit-sortable-position>
                <input
                  type="text"
                  readonly
                  class="w-8 text-right text-xs text-gray-400 bg-transparent border-none pointer-events-none"
                  name={`items-${id}[][position]`}
                />
              </hyperkit-sortable-position>
              <input type="hidden" name={`items-${id}[][id]`} value={item.id} />
              <hyperkit-fieldset-destroyer>
                <button
                  type="button"
                  class="pb-1 text-lg text-red-500 rounded hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-200"
                >
                  ×
                </button>
              </hyperkit-fieldset-destroyer>
            </hyperkit-repeated-fieldset>
          </hyperkit-sortable-item>
        ))
      }
    </hyperkit-sortable>
    <template slot="new-fieldset">
      <hyperkit-sortable-item
        class="py-2 border-b border-b-zinc-200 data-[before]:border-t-2 data-[before]:border-t-blue-400 data-[after]:border-b-2 data-[after]:border-b-blue-400"
      >
        <hyperkit-repeated-fieldset class="flex items-end justify-between">
          <hyperkit-sortable-handle>
            <button
              class="pb-1 cursor-move text-zinc-400 select-none font-black"
            >
              &#8942;
            </button>
          </hyperkit-sortable-handle>
          <label class="mr-2">
            <div class="mb-1 text-zinc-600 text-xs">First Name:</div>
            <input
              type="text"
              name={`items-${id}[][firstname]`}
              class="w-16 lg:w-24 px-3 py-2 text-xs text-gray-800 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
            />
          </label>
          <label>
            <div class="mb-1 text-zinc-600 text-xs">Last Name:</div>
            <input
              type="text"
              name={`items-${id}[][lastname]`}
              class="w-16 lg:w-24 px-3 py-2 text-xs text-gray-800 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
            />
          </label>
          <hyperkit-sortable-position>
            <input
              type="text"
              readonly
              class="w-8 text-right text-xs text-gray-400 bg-transparent border-none pointer-events-none"
              name={`items-${id}[][position]`}
            />
          </hyperkit-sortable-position>
          <hyperkit-fieldset-destroyer>
            <button
              type="button"
              class="pb-1 text-lg text-red-500 rounded hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-200"
            >
              ×
            </button>
          </hyperkit-fieldset-destroyer>
        </hyperkit-repeated-fieldset>
      </hyperkit-sortable-item>
    </template>
  </hyperkit-fieldset-repeater>
  <hyperkit-fieldset-creator for={id}>
    <button
      type="button"
      class="px-2.5 py-2 text-xs shadow-sm rounded border-none bg-zinc-800 text-zinc-200 hover:bg-zinc-900 flex items-center justify-center font-medium w-full whitespace-nowrap transition-all duration-200"
    >
      Add Item
    </button>
  </hyperkit-fieldset-creator>
</div>

<script>
  import "@hyperkitxyz/elements/fieldset-repeater.ts";
  import "@hyperkitxyz/elements/sortable.ts";
  import "drag-drop-touch";
</script>
